{
  "name": "Type Safety Improvements",
  "branchName": "fix/type-safety-improvements",
  "userStories": [
    {
      "id": "US-TI-001",
      "title": "Phase 1 - Critical Type Safety Issues",
      "description": "As a developer, I want Hono route handlers and core business logic to have proper type annotations so that TypeScript can catch errors at compile time rather than runtime.",
      "acceptanceCriteria": [
        "All c: any parameters in route handlers replaced with proper Hono Context type",
        "Record<string, any> replaced with Record<string, unknown> in oauth.ts",
        "Non-null assertion on authResult.data.user!.id in login.ts replaced with proper null check",
        "TypeScript compiles with no errors (tsc --noEmit passes)",
        "All existing tests pass",
        "No breaking changes to API contracts"
      ],
      "priority": 1,
      "passes": true,
      "dependsOn": [],
      "filesInScope": [
        "backend/src/routes/oauth.ts",
        "backend/src/routes/register.ts",
        "backend/src/routes/login.ts"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-TI-002",
      "title": "Phase 2 - Moderate Type Safety Issues",
      "description": "As a developer, I want test mocks and type assertions to be properly typed so that tests accurately reflect production behavior and catch type-related regressions.",
      "acceptanceCriteria": [
        "Supabase mock client properly typed (session, query builder returns)",
        "as assertions in oauth.ts replaced with runtime type guards or Zod validation",
        "Non-null assertions in oauth-e2e.test.ts replaced with proper null checks",
        "Test response data in matches.test.ts properly typed (no as any casts)",
        "TypeScript compiles with no errors",
        "All existing tests pass"
      ],
      "priority": 2,
      "passes": true,
      "dependsOn": [
        "US-TI-001"
      ],
      "filesInScope": [
        "backend/tests/mocks/supabase.ts",
        "backend/src/routes/oauth.ts",
        "backend/tests/routes/oauth-e2e.test.ts",
        "backend/tests/routes/matches.test.ts"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-TI-003",
      "title": "Phase 3 - Structural Type Improvements",
      "description": "As a developer, I want consistent type patterns across the codebase so that new code follows established conventions and the codebase remains maintainable.",
      "acceptanceCriteria": [
        "object type in mcp-server/src/api.ts replaced with specific PersonPreferences interface",
        "Shared OAuth types extracted to backend/src/schemas/oauth.ts",
        "MCP tool handling uses discriminated unions instead of string comparisons",
        "Standardized test response type patterns documented and applied",
        "TypeScript compiles with no errors",
        "All existing tests pass"
      ],
      "priority": 3,
      "passes": true,
      "dependsOn": [
        "US-TI-002"
      ],
      "filesInScope": [
        "mcp-server/src/api.ts",
        "backend/src/schemas/oauth.ts",
        "backend/src/routes/mcp.ts"
      ],
      "completionNotes": "Completed by agent"
    }
  ],
  "metadata": {
    "createdAt": "2026-01-23T00:00:00.000Z",
    "updatedAt": "2026-01-24T14:49:20.765Z"
  }
}